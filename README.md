# Copilot Widget Dummy MERN Application

A full-stack demo that showcases cookie- and token-based authentication across a Node/Express API and a React frontend. The project is designed to help you experiment with login flows, protected routes, and basic session restoration.

## Project Structure

- `src/` – Express server with authentication middleware, sign-in endpoints, and the protected `participant-summary` route.
- `frontend/` – React UI (TypeScript + CRA) with a styled sign-in experience and dashboard that calls the API.
- `dist/` – Compiled TypeScript output (generated by `npm run build`).

## Features

- **Dual auth modes** – Issue either HTTP-only session cookies or JWT bearer tokens using the same credentials.
- **Middleware-first security** – Token validation is prioritized, with cookie fallback if no token is provided.
- **Session restoration** – Frontend restores active cookies automatically and optionally persists issued tokens across refreshes.
- **Ready for deployment** – Configuration and build scripts are aligned with Render (or any Node/React host).

## Prerequisites

- Node.js 20.x (match the version declared in `NODE_VERSION` when deploying).
- npm 10+ (ships with Node 20).

## Environment Variables

Create a `.env` file in the project root for local development:

```
PORT=4000
CLIENT_ORIGIN=http://localhost:3000
JWT_SECRET=dev-secret
```

> On Render (or other hosts) use `CLIENT_ORIGINS` (comma-separated) to cover multiple allowed domains, and always replace `JWT_SECRET` with a strong value.

### Frontend runtime config

`frontend/.env` (optional) lets you point the UI to a different API base:

```
REACT_APP_API_BASE_URL=http://localhost:4000
```

If omitted, the frontend defaults to `http://localhost:4000`.

## Local Development

1. Install backend dependencies (from repo root):
   ```bash
   npm install
   ```
2. Install frontend dependencies:
   ```bash
   cd frontend
   npm install
   cd ..
   ```
3. Start API in watch mode:
   ```bash
   npm run dev
   ```
   API listens on `http://localhost:4000`.
4. Start the React dev server:
   ```bash
   cd frontend
   npm start
   ```
   UI runs at `http://localhost:3000`.

## Build Scripts

- `npm run build` – Compiles backend TypeScript to `dist/`.
- `npm run start` – Runs the compiled backend (`node dist/server.js`).
- `npm run dev` – Watches `src/` with `ts-node` + `nodemon`.
- `cd frontend && npm run build` – Produces production assets in `frontend/build/`.

## Authentication Flow

1. Sign in using the shared credentials (`neha.tanwar@kornferry.com` / `Neha@123`).
2. Backend issues either:
   - Session cookie (`/auth/sign-in-cookie`) stored as `httpOnly`.
   - JWT token (`/auth/sign-in-token`) with 1h expiry.
3. `/participant-summary` checks for a bearer token first, then a valid cookie. Response includes the authenticated method and expiry details.

## Deployment (Render)

### Web Service (API)
- Build: `npm install && npm run build`
- Start: `npm run start`
- Environment variables:
  - `NODE_VERSION=20`
  - `JWT_SECRET=<strong-secret>`
  - `CLIENT_ORIGINS=https://your-frontend.onrender.com,http://localhost:3000`

### Static Site (React)
- Root directory: `frontend`
- Build command: `npm install && npm run build`
- Publish directory: `build`
- Environment variables:
  - `REACT_APP_API_BASE_URL=https://your-api.onrender.com`

## Testing with Postman

1. `POST /auth/sign-in-token` with the demo credentials; copy the `token` from the response.
2. `GET /participant-summary` with header `Authorization: Bearer <token>`.
3. For cookie flow, `POST /auth/sign-in-cookie` (ensure Postman is set to store cookies) and hit the same GET endpoint without the auth header.

## License

This demo is provided without a specific license. Adapt it freely for internal experiments or as a starting point for a production-ready flow.
